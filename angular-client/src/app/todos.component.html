<div class="todo-app">
  <header>
    <div class="user-info">
      <span class="username">Welcome, {{ getCurrentUsername() }}!</span>
      <button (click)="goToProfile()" class="profile-btn">Profile</button>
      <button (click)="logout()" class="logout-btn">Logout</button>
    </div>
  </header>

  <section class="todoapp">
    <header class="header">
      <h1>todos</h1>
      <div class="add-todo-container">
        <input class="new-todo" placeholder="What needs to be done?" autofocus="" [formControl]="newTodoText" (keyup.enter)="addTodo()">
        <button class="add-todo-btn" (click)="addTodo()" [disabled]="!newTodoText.value?.trim()">
          <span>Add</span>
        </button>
      </div>
    </header>
    <section class="main" *ngIf="todoStore.todos.length > 0">
      <div class="ai-controls">
        <button 
          (click)="prioritizeWithAI()" 
          class="ai-prioritize-btn"
          [disabled]="isAILoading">
          <span *ngIf="!isAILoading">ðŸ¤– AI Prioritize</span>
          <span *ngIf="isAILoading">ðŸ¤– Analyzing...</span>
        </button>
      </div>
      
      <div *ngIf="aiInsights" class="ai-insights">
        <h4>ðŸ’¡ AI Insights</h4>
        <p>{{ aiInsights }}</p>
      </div>
      
      <input id="toggle-all" class="toggle-all" type="checkbox" *ngIf="todoStore.todos.length" #toggleall [checked]="todoStore.allCompleted()" (click)="todoStore.setAllTo(toggleall.checked)">
      <ul class="todo-list">
        <li *ngFor="let todo of todoStore.todos" [class.completed]="todo.completed" [class.editing]="todo.editing">
          <div class="view">
            <input class="toggle" type="checkbox" (click)="toggleCompletion(todo)" [checked]="todo.completed">
            <div class="todo-info">
              <div class="todo-header">
                <label (dblclick)="editTodo(todo)">{{todo.title}}</label>
                <div class="todo-meta">
                  <span class="created-by">Created by: {{todo.createdBy}}</span>
                  <span class="assigned-to">Assigned to: {{todo.assignedTo}}</span>
                  <!-- AI Priority Indicator -->
                  <span *ngIf="getAIPriority(todo)" class="ai-priority-badge" [title]="getAIReason(todo)">
                    ðŸ¤– #{{ getAIPriority(todo) }}
                  </span>
                </div>
              </div>
              <div class="todo-controls">
                <select [(ngModel)]="todo.priority" (ngModelChange)="updatePriority(todo)" [class.highlightRed]="todo.priority === 'Hi-Pri'">
                  <option value="Hi-Pri">Hi-Pri</option>
                  <option value="Medium">Medium</option>
                  <option value="Low">Low</option>
                </select>
                <select [(ngModel)]="todo.assignedTo" (ngModelChange)="updateAssignment(todo)" class="assignment-select">
                  <option *ngFor="let user of availableUsers" [value]="user.username">{{user.username}}</option>
                </select>
              </div>
            </div>
            <button class="destroy" (click)="remove(todo)"></button>
          </div>
          <input class="edit" *ngIf="todo.editing" [value]="todo.title" #editedtodo (blur)="stopEditing(todo, editedtodo.value)" (keyup.enter)="updateEditingTodo(todo, editedtodo.value)" (keyup.escape)="cancelEditingTodo(todo)">
        </li>
      </ul>
    </section>
    <footer class="footer" *ngIf="todoStore.todos.length > 0">
      <span class="todo-count"><strong>{{todoStore.getRemaining().length}}</strong> {{todoStore.getRemaining().length == 1 ? 'item' : 'items'}} left</span>
      <button class="clear-completed" *ngIf="todoStore.getCompleted().length > 0" (click)="removeCompleted()">Clear completed</button>
    </footer>
  </section>
</div> 